
<!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="tgtest-ignore" content="all">
<!-- <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1.0, maximum-scale=1, user-scalable=no,viewport-fit=cover" />
<meta http-equiv="X-UA-Compatible" content="IE=EmulateIE10">
<meta http-equiv="X-UA-Compatible" content="IE=edge" /> -->
<meta content="telephone=no" name="format-detection" />
<title>新年月度签到礼</title>
<style>
.box{width: 1200px;height: auto;margin: 0 auto;background-color: rgb(235, 235, 235);}
h1{text-align: center;}
button{height: 30px;width: 80px;border-radius: 15px;background-color: darkorange;}
.imgBox{width: 100%;height: 1550px;overflow: hidden;}
.imgBox img{max-width: 100%;}
</style>
</head>
<body>
	<div class="box">
		<button class="dwonload">DwonLoad</button>
		<input type="file" class="upload"></input>
		<h1>周报打包工具</h1>
		<div class="imgBox">
			<img src="./img/award01.png" alt="">
			<img src="./img/back.png" alt="">
			<img src="./img/cover.png" alt="">
			<img src="./img/递四方速递 (1).jpg" alt="" >
			<img src="./img/btns2.png">
			<img src="./img/pop-dj05.png" alt="">
			<img src="./img/pop-dj06.png" alt="">
		</div>
	</div>


<!-- <script src="./js/html2canvas.js"></script>
<script src="./js/jsPdf.debug.js"></script> -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/jspdf/1.5.3/jspdf.debug.js"></script>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/0.5.0-beta4/html2canvas.js"></script>
<script>
/*$('.dwonload').ontap(function(){
	let box = $('.main'),
	awidth = box.width(),
	aHeight = box.height();
	// return
	setTimeout(function(){
		html2canvas(document.body, {
			useCORS:true,
			// height:aHeight,
			// width:awidth,
			scale:'2',
			dpi:'192',
			allowTaint:false,
			onrendered:function(canvas) {
				var contentWidth = canvas.width;
				var contentHeight = canvas.height;
				var imgWidth = 595.28;
				var imgHeight = 592.28/contentWidth * contentHeight;	
				var pageData = canvas.toDataURL('image/jpeg', 1.0);

                //方向默认竖直，尺寸ponits，格式a4[595.28,841.89]
                var pdf = new jsPDF('', 'pt', 'a4');

                //addImage后两个参数控制添加图片的尺寸，此处将页面高度按照a4纸宽高比列进行压缩
				pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight );
				// var contentWidth = canvas.width;
				// var contentHeight = canvas.height;
				// console.log(contentWidth,contentHeight)
				// //一页pdf显示html页面生成的canvas高度;
				// // var pageHeight = contentWidth / 592.28 * 841.89;
				// var pageHeight = contentWidth / 592.28 * 841.89;
				// //未生成pdf的html页面高度
				// var leftHeight = contentHeight;
				// //页面偏移
				// var position = 0;
				// //a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
				// // var imgWidth = 595.28;
				// // var imgHeight = 592.28/contentWidth * contentHeight;
				// var imgWidth = awidth;
				// var imgHeight = aHeight;

				// var pageData = canvas.toDataURL('image/jpeg', 1.0);
				// console.log(pageData)

				// var pdf = new jsPDF('landscape', 'pt',[awidth,aHeight]);

				// //有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
				// //当内容未超过pdf一页显示的范围，无需分页
				// if (leftHeight < pageHeight) {
				// pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight );
				// } else {
				// 	while(leftHeight > 0) {
				// 		pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
				// 		leftHeight -= pageHeight;
				// 		position -= 841.89;
				// 		//避免添加空白页
				// 		if(leftHeight > 0) {
				// 			pdf.addPage();
				// 		}
				// 	}
				// }

				pdf.save('main.pdf');
			}
		})
	},500)

})*/
</script>
<script>

	$('.dwonload').click(function(){
		download()
	})
	function download(){
		var element = $(".box");    // 这个dom元素是要导出pdf的div容器
		var w = element.width();    // 获得该容器的宽
		var h = element.height();    // 获得该容器的高
		var offsetTop = element.offset().top;    // 获得该容器到文档顶部的距离
		var offsetLeft = element.offset().left;    // 获得该容器到文档最左的距离
		var canvas = document.createElement("canvas");
		var abs = 0;
		var win_i = $(window).width();    // 获得当前可视窗口的宽度（不包含滚动条）
		var win_o = window.innerWidth;    // 获得当前窗口的宽度（包含滚动条）
		if(win_o>win_i){
			abs = (win_o - win_i)/2;    // 获得滚动条长度的一半
		}
		canvas.width = w * 2;    // 将画布宽&&高放大两倍
		canvas.height = h * 2;
		var context = canvas.getContext("2d");
		context.scale(2, 2);
		context.translate(-offsetLeft-abs,-offsetTop);    
		// 这里默认横向没有滚动条的情况，因为offset.left(),有无滚动条的时候存在差值，因此        
		// translate的时候，要把这个差值去掉
		html2canvas(element,{useCORS:true,dpi:300}).then(function(canvas) {
			var contentWidth = canvas.width;
			var contentHeight = canvas.height;
			//一页pdf显示html页面生成的canvas高度;
			var pageHeight = contentWidth / 592.28 * 841.89;
			//未生成pdf的html页面高度
			var leftHeight = contentHeight;
			//页面偏移
			var position = 0;
			//a4纸的尺寸[595.28,841.89]，html页面生成的canvas在pdf中图片的宽高
			var imgWidth = 595.28;
			var imgHeight = 592.28/contentWidth * contentHeight;

			var pageData = canvas.toDataURL('image/jpeg', 1.0);

			var pdf = new jsPDF('', 'pt', 'a4');

			//有两个高度需要区分，一个是html页面的实际高度，和生成pdf的页面高度(841.89)
			//当内容未超过pdf一页显示的范围，无需分页
			if (leftHeight < pageHeight) {
			pdf.addImage(pageData, 'JPEG', 0, 0, imgWidth, imgHeight);
			} else {    // 分页
				while(leftHeight > 0) {
					pdf.addImage(pageData, 'JPEG', 0, position, imgWidth, imgHeight)
					leftHeight -= pageHeight;
					position -= 841.89;
					//避免添加空白页
					if(leftHeight > 0) {
						pdf.addPage();
					}
				}
			}
			pdf.save('test.pdf');        
		})
	}
</script>
</body>
</html>